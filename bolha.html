<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Simulador — Bolha de Ativos</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  html { min-height: 100%; }
  body {
    font-family: 'Poppins', sans-serif;
    background: radial-gradient(circle at top left, #0f172a, #020617);
    margin: 0;
    padding: 20px;
    color: #e2e8f0;
    /* Removido overflow: hidden para permitir o scroll */
    min-height: 100vh; /* Garante que o body ocupe a altura total */
    display: flex;
    flex-direction: column; /* Permite que o conteúdo e o footer se separem */
  }

  #particles {
    position: absolute; /* Alterado de fixed para absolute */
    top: 0; left: 0;
    width: 100%;
    height: 100%; /* Será ajustado via JS para cobrir o conteúdo */
    z-index: 0;
  }

  .wrap {
    position: relative;
    z-index: 1;
    max-width: 1100px;
    margin: 0 auto;
    padding: 0; /* Removido padding vertical desnecessário aqui */
    flex-grow: 1; /* Permite que o conteúdo ocupe o espaço restante */
  }

  h1 {
    margin-bottom: 6px;
    color: #38bdf8;
    font-size: 2rem;
    text-align: center;
  }

  p.small {
    color: #94a3b8;
    margin-top: 0;
    margin-bottom: 20px;
    text-align: center;
  }

  .controls {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 12px;
    align-items: center;
    justify-content: center; /* Centraliza os controles */
  }

  .ctrl {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(8px);
    padding: 12px;
    border-radius: 15px; /* Ajustado para o padrão */
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4); /* Adicionado sombra */
    flex: 1 1 240px;
    min-width: 220px;
  }

  label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
    font-size: 0.95rem;
    color: #e0f2fe;
  }

  .value {
    font-weight: 700;
    color: #38bdf8;
  }

  input[type=range] {
    width: 100%;
    accent-color: #38bdf8;
  }

  #charts {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center; /* Centraliza os gráficos */
  }

  .chart-card {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 15px;
    padding: 14px;
    flex: 1 1 540px;
    min-width: 320px;
  }

  canvas {
    width: 100%!important;
    height: 320px!important;
    background: #0f172a; /* Fundo escuro para o gráfico */
    border-radius: 10px;
    box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.05);
  }

  .info {
    display: flex;
    gap: 12px;
    align-items: center;
    margin-top: 10px;
    flex-wrap: wrap;
  }

  .badge {
    background: rgba(56,189,248,0.1);
    padding: 8px 12px;
    border-radius: 10px;
    font-weight: 600;
    color: #38bdf8;
  }

  .status {
    padding: 8px 12px;
    border-radius: 10px;
    font-weight: 600;
  }

  .status.ok {
    background: rgba(34,197,94,0.1);
    color: #4ade80; /* Cor ajustada */
  }

  .status.warn {
    background: rgba(251,191,36,0.1);
    color: #facc15;
  }

  .status.bad {
    background: rgba(239,68,68,0.1);
    color: #f87171; /* Cor ajustada */
  }

  #resetBtn {
    margin-left: auto;
    padding: 8px 14px;
    border-radius: 8px;
    border: none;
    background: #38bdf8;
    color: #0f172a;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  #resetBtn:hover {
    background: #0ea5e9;
    box-shadow: 0 0 15px rgba(56,189,248,0.4);
  }

  footer {
    margin-top: 20px;
    color: #64748b;
    font-size: 0.9rem;
    text-align: center;
    padding: 15px 0; /* Adicionado padding para não colar no final */
    position: relative; /* Garante que o footer não fique por cima de tudo */
    z-index: 1;
  }

  a.back {
    display: inline-block;
    margin-bottom: 12px;
    text-decoration: none;
    color: #94a3b8;
    transition: color 0.2s;
    font-weight: 600;
  }

  a.back:hover {
    color: #38bdf8;
  }
</style>
</head>
<body>
<canvas id="particles"></canvas>
<div class="wrap">
  <a href="index.html" class="back">← Voltar ao início</a>
  <h1>Simulador — Bolha de Ativos</h1>
  <p class="small">Ajuste a <strong>liquidez</strong> e o <strong>choque de expectativas</strong> e observe a formação e o estouro de bolhas. O modelo mostra retroalimentação preço–expectativa e comportamento de manada.</p>

  <div class="controls">
    <div class="ctrl">
      <label>Liquidez</label>
      <input id="liquidity" type="range" min="0.5" max="2.5" step="0.05" value="1.0">
      <div>Valor: <span id="liquidityVal" class="value">1.00</span></div>
    </div>

    <div class="ctrl">
      <label>Expectativas (choque exógeno)</label>
      <input id="expSlider" type="range" min="0.6" max="2.5" step="0.01" value="1.10">
      <div>Valor: <span id="expVal" class="value">1.10</span></div>
      <div style="font-size:12px;color:#94a3b8;margin-top:6px">Mudar aqui aplica um choque temporário.</div>
    </div>

    <div class="ctrl">
      <label>Força do choque inicial</label>
      <input id="shockK" type="range" min="0" max="0.06" step="0.002" value="0.02">
      <div>Coeficiente k: <span id="shockKVal" class="value">0.02</span></div>
    </div>

    <button id="resetBtn">Reset</button>
  </div>

  <div id="charts">
    <div class="chart-card">
      <canvas id="priceChart"></canvas>
      <div class="info">
        <div class="badge">Preço: <span id="priceBadge">-</span></div>
        <div class="badge">Fundamental: <span id="fundBadge">-</span></div>
        <div id="stateStatus" class="status warn">Iniciando</div>
      </div>
    </div>

    <div class="chart-card">
      <canvas id="expChart"></canvas>
      <div class="info">
        <div class="badge">Expectativas: <span id="expBadge">-</span></div>
      </div>
    </div>
  </div>

  <footer>Modelo simplificado para fins didáticos: demonstra retroalimentação entre preços e expectativas, formação e estouro de bolhas.</footer>
</div>

<script>
const H = 200;
let t=0, price=100, fundamental=85, baseFundamental=85, expectations=1.1, liquidity=1.0;
let inBubble=false, busted=false, userLocked=false, lockTimer=0, bubbleCap=NaN;

const liquidityEl=document.getElementById('liquidity');
const liquidityVal=document.getElementById('liquidityVal');
const expSlider=document.getElementById('expSlider');
const expVal=document.getElementById('expVal');
const shockK=document.getElementById('shockK');
const shockKVal=document.getElementById('shockKVal');
const priceBadge=document.getElementById('priceBadge');
const fundBadge=document.getElementById('fundBadge');
const expBadge=document.getElementById('expBadge');
const stateStatus=document.getElementById('stateStatus');
const resetBtn=document.getElementById('resetBtn');

let times=[0], prices=[price], fundamentals=[fundamental], exps=[expectations];

const randn=s=>Math.sqrt(-2*Math.log(Math.random()))*Math.cos(2*Math.PI*Math.random())*s;

const ctx1=document.getElementById('priceChart').getContext('2d');
const ctx2=document.getElementById('expChart').getContext('2d');
const priceChart=new Chart(ctx1,{type:'line',data:{labels:times,datasets:[
  {label:'Preço',data:prices,borderColor:'#38bdf8',tension:0.15,borderWidth:2,fill:false,pointRadius:0},
  {label:'Valor Fundamental',data:fundamentals,borderColor:'#94a3b8',borderDash:[6,4],tension:0.1,borderWidth:1,fill:false,pointRadius:0}
]},options:{animation:false,responsive:true,maintainAspectRatio:false,scales:{x:{title:{display:true,text:'Tempo', color: '#e2e8f0'}, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.1)' }},y:{title:{display:true,text:'Preço', color: '#e2e8f0'}, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.1)' }}}, plugins:{legend:{labels:{color:'#e2e8f0'}}}}});
const expChart=new Chart(ctx2,{type:'line',data:{labels:times,datasets:[
  {label:'Expectativas',data:exps,borderColor:'#4ade80',tension:0.2,borderWidth:2,fill:false,pointRadius:0} /* Cor ajustada */
]},options:{animation:false,responsive:true,maintainAspectRatio:false,scales:{x:{title:{display:true,text:'Tempo', color: '#e2e8f0'}, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.1)' }},y:{title:{display:true,text:'Expectativas', color: '#e2e8f0'}, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.1)' }}},plugins:{legend:{display:false}}}});

const baseNoiseFund=0.2, meanRevFund=0.02, expNoise=0.01;
const expMeanRev=0.01, specK=0.5, bubbleTrigger=1.3, recoverySpeed=0.01;

function step(){
  liquidity=parseFloat(liquidityEl.value);
  liquidityVal.textContent=liquidity.toFixed(2);

  fundamental += -meanRevFund*(fundamental-baseFundamental)+randn(baseNoiseFund*0.5);

  if(!userLocked){
    expectations += -expMeanRev*(expectations-1)+randn(expNoise)*0.005;
  } else if(--lockTimer<=0){ userLocked=false; }

  if(!busted){
    let growth=specK*(expectations-1)*0.01*liquidity + 0.02*(fundamental-price)/price + randn(0.001)*liquidity;

    if(expectations > bubbleTrigger && !inBubble){
      inBubble=true;
      bubbleCap=fundamental*(2.5+Math.random()*8.0*(liquidity**2)*expectations);
    }

    if(inBubble){
      growth += 0.02*(expectations-1)*liquidity;
      expectations += 0.01*(price/fundamental - 1);
      if(price>=bubbleCap){
        busted=true; inBubble=false;
        price=Math.max(1,fundamental*0.6*(0.7+Math.random()*0.3));
        expectations=Math.max(0.5,expectations*0.5);
      } else {
        price*=(1+growth);
      }
    } else price*=(1+growth);
  } else {
    price+=(fundamental-price)*recoverySpeed;
    expectations+=(1-expectations)*recoverySpeed*0.5;
    if(Math.abs(price-fundamental)<2 && Math.abs(expectations-1)<0.05){busted=false;}
  }

  expectations=Math.min(3,Math.max(0.4,expectations));
  if(!isFinite(price)||price<=0)price=1;

  t++;
  times.push(t); prices.push(price); fundamentals.push(fundamental); exps.push(expectations);
  if(times.length>H){times.shift();prices.shift();fundamentals.shift();exps.shift();}

  expSlider.value=expectations; expVal.textContent=expectations.toFixed(2);
  priceChart.data.labels=times; priceChart.data.datasets[0].data=prices; priceChart.data.datasets[1].data=fundamentals; priceChart.update('none');
  expChart.data.labels=times; expChart.data.datasets[0].data=exps; expChart.update('none');

  priceBadge.textContent=price.toFixed(2);
  fundBadge.textContent=fundamental.toFixed(2);
  expBadge.textContent=expectations.toFixed(3);

  if(busted){stateStatus.textContent='Bolha estourou — correção em curso';stateStatus.className='status bad';}
  else if(inBubble){stateStatus.textContent='Bolha em formação';stateStatus.className='status warn';}
  else{stateStatus.textContent='Mercado em equilíbrio';stateStatus.className='status ok';}

  requestAnimationFrame(step);
}

expSlider.addEventListener('input',e=>{
  const newV=Number(e.target.value);
  const k=Number(shockK.value);
  const delta=newV-expectations;
  expectations=newV;
  userLocked=true; lockTimer=180;
  expVal.textContent=expectations.toFixed(2);
  price*=(1+k*delta*liquidity);
});
shockK.addEventListener('input',()=>shockKVal.textContent=Number(shockK.value).toFixed(3));
liquidityEl.addEventListener('input',()=>liquidityVal.textContent=liquidityEl.value);
resetBtn.addEventListener('click',()=>{
  t=0;price=100;fundamental=baseFundamental;expectations=1.1;liquidity=1.0;inBubble=busted=false;
  times=[0];prices=[price];fundamentals=[fundamental];exps=[expectations];
  liquidityEl.value=liquidity;expSlider.value=expectations;shockK.value=0.02;
});

requestAnimationFrame(step);
</script>

<script>
  // fundo animado - partículas conectadas
  const canvas = document.getElementById('particles');
  const ctx = canvas.getContext('2d');
  let particlesArray = [];
  const numParticles = 80;

  canvas.width = window.innerWidth;
  canvas.height = document.body.scrollHeight;

  class Particle {
    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 2;
      this.speedX = (Math.random() - 0.5) * 0.8;
      this.speedY = (Math.random() - 0.5) * 0.8;
    }
    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
      if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
    }
    draw() {
      ctx.fillStyle = '#38bdf8';
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function connect() {
    for (let a = 0; a < particlesArray.length; a++) {
      for (let b = a; b < particlesArray.length; b++) {
        let dx = particlesArray[a].x - particlesArray[b].x;
        let dy = particlesArray[a].y - particlesArray[b].y;
        let distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < 100) {
          ctx.strokeStyle = 'rgba(56,189,248,0.1)';
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(particlesArray[a].x, particlesArray[a].y);
          ctx.lineTo(particlesArray[b].x, particlesArray[b].y);
          ctx.stroke();
        }
      }
    }
  }

  function initParticles() {
    particlesArray = [];
    for (let i = 0; i < numParticles; i++) {
      particlesArray.push(new Particle());
    }
  }

  function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let particle of particlesArray) {
      particle.update();
      particle.draw();
    }
    connect();
    requestAnimationFrame(animateParticles);
  }

  function resizeCanvas() {
    // Calcula a altura total do conteúdo, incluindo margens e padding
    const bodyHeight = Math.max(
      document.body.scrollHeight,
      document.body.offsetHeight,
      document.documentElement.clientHeight,
      document.documentElement.scrollHeight,
      document.documentElement.offsetHeight
    );
    canvas.width = window.innerWidth;
    canvas.height = bodyHeight;
    initParticles();
  }

  window.addEventListener('resize', resizeCanvas);
  window.addEventListener('load', resizeCanvas);
  
  // Adiciona um pequeno delay para garantir que o conteúdo dinâmico seja carregado
  setTimeout(resizeCanvas, 500);

  initParticles();
  animateParticles();
</script>
</body>
</html>
